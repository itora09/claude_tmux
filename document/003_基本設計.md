# 基本設計書 - クリックゲームWebサイト

## 1. システム構成設計

### 1.1 アーキテクチャ概要

本システムは完全にクライアントサイドで動作する単一ページアプリケーション（SPA）として設計する。サーバーサイドの処理は不要で、静的ファイルのみで構成される。

**システム構成**：
- **フロントエンド**: HTML + CSS + バニラJavaScript
- **データ永続化**: ブラウザのlocalStorage
- **画像リソース**: 静的ファイル（お客様提供）
- **実行環境**: モダンWebブラウザ

### 1.2 技術スタック選定

#### フロントエンド技術
- **HTML5**: セマンティックなマークアップ、レスポンシブデザイン対応
- **CSS3**: Flexbox/Grid、アニメーション、カスタムプロパティ使用
- **バニラJavaScript (ES6+)**: フレームワーク不使用、軽量で高速な動作
- **CDN ライブラリ**: 必要に応じて外部CDNから読み込み

#### 開発環境
- **開発サーバー**: Node.js http-server
- **バージョン管理**: Git
- **エディタ**: VS Code推奨

#### 技術選定の根拠
- **軽量性**: フレームワーク不使用により高速読み込み
- **保守性**: 依存関係を最小化、長期保守に適している
- **互換性**: 幅広いブラウザでの動作保証
- **拡張性**: 機能追加時の柔軟性確保

### 1.3 ディレクトリ構成

```
click-game/
├── index.html              # メインHTMLファイル
├── css/
│   ├── style.css          # メインスタイルシート
│   └── responsive.css     # レスポンシブスタイル
├── js/
│   ├── main.js           # メインアプリケーションロジック
│   ├── game.js           # ゲーム制御ロジック
│   ├── timer.js          # タイマー機能
│   ├── character.js      # キャラクター表示制御
│   └── storage.js        # データ永続化処理
├── images/
│   ├── characters/
│   │   ├── normal/       # 通常表情画像（5枚）
│   │   └── silly/        # アホ顔画像（2枚）
│   └── ui/               # UIアイコン等
├── package.json          # 開発用依存関係管理
└── README.md            # プロジェクト説明書
```

## 2. データ設計

### 2.1 データモデル定義

#### ゲーム状態データ（メモリ上）
```
GameState {
  - clickCount: 整数（0-40）
  - gameStatus: 列挙型（waiting, playing, finished）
  - startTime: タイムスタンプ
  - endTime: タイムスタンプ
  - currentCharacter: 文字列（画像ファイル名）
}
```

#### 記録データ（localStorage）
```
GameRecord {
  - bestTime: 浮動小数点数（秒、小数点以下2桁）
}
```

#### キャラクター画像データ
```
CharacterImages {
  - normalFaces: 配列[画像パス5個]
  - sillyFaces: 配列[画像パス2個]
}
```

### 2.2 データベース設計

データベースは使用せず、全てクライアントサイドで処理する。

### 2.3 データ永続化方針

- **記録保存**: localStorage使用
- **キー名**: "clickGameBestTime"
- **データ形式**: JSON文字列
- **エラーハンドリング**: localStorage無効時はセッション中のみ記録保持

### 2.4 状態管理設計

- **中央集権的状態管理**: GameStateオブジェクトで全状態を管理
- **状態変更**: 専用の更新関数経由でのみ変更
- **イベント駆動**: DOM要素の変更は状態変更に連動
- **不変性**: 状態更新時は新しいオブジェクトを生成

## 3. 画面設計

### 3.1 画面一覧と役割

#### 3.1.1 メインゲーム画面
- **役割**: ゲームプレイ全体を統括
- **表示要素**: キャラクター、カウンター、クリックボタン、最速記録
- **状態**: 待機中、ゲーム中、結果表示の3状態

#### 3.1.2 結果表示領域
- **役割**: ゲーム終了時の結果表示
- **表示要素**: 今回のタイム、記録判定、再プレイボタン
- **表示条件**: ゲーム終了時にメイン画面に重畳表示

### 3.2 画面レイアウト設計

#### レイアウト方針
- **基本構造**: 縦方向の中央揃えレイアウト
- **レスポンシブ**: モバイルファーストデザイン
- **視覚階層**: 重要度に応じたサイズ・配色設計

#### 要素配置順序（上から下）
1. 最速記録表示エリア
2. キャラクター表示エリア（メイン）
3. カウンター表示エリア
4. クリックボタンエリア
5. ゲーム状態表示エリア

### 3.3 ワイヤーフレーム

#### デスクトップ版（1024px以上）
- キャラクター: 400×400px
- クリックボタン: 200×80px
- カウンター: 64px フォントサイズ
- 最大幅: 800px、中央配置

#### タブレット版（768px-1023px）
- キャラクター: 300×300px
- クリックボタン: 180×70px
- カウンター: 48px フォントサイズ
- 最大幅: 600px

#### モバイル版（320px-767px）
- キャラクター: 250×250px
- クリックボタン: 150×60px
- カウンター: 36px フォントサイズ
- 最大幅: 90%

### 3.4 UI/UXコンポーネント設計

#### コンポーネント設計方針
- **統一性**: 一貫したデザインパターンの適用
- **再利用性**: 共通スタイル・動作の標準化
- **アクセシビリティ**: 全コンポーネントで統一されたアクセシビリティ対応
- **レスポンシブ**: すべてのデバイスで適切に動作する設計

#### 主要コンポーネント概要
- **ボタン系**: クリックボタン、再プレイボタン
- **表示系**: キャラクター表示、カウンター表示、記録表示
- **レイアウト系**: メインコンテナ、結果表示モーダル

各コンポーネントの詳細な視覚仕様・相互作用・状態管理は実装フェーズで策定する。

### 3.5 画面遷移図

```
[待機画面] → [クリック] → [ゲーム中]
                              ↓
                        [40回到達]
                              ↓
                        [結果表示]
                              ↓
                      [再プレイボタン]
                              ↓
                        [待機画面]
```

### 3.6 フロントエンド処理フロー

#### ゲーム開始フロー
1. 初期状態の設定（カウンター0、キャラクター通常顔）
2. 最速記録の読み込み（localStorage）
3. クリックボタンの有効化

#### クリック処理フロー
1. クリックイベント受信
2. 初回クリック判定（タイマー開始）
3. カウンターインクリメント
4. 特別数字判定（3の倍数・3を含む数字）
5. キャラクター画像切り替え
6. 40回到達判定

#### ゲーム終了フロー
1. タイマー停止、結果時間計算
2. 最速記録との比較判定
3. 記録更新時はlocalStorage保存
4. 結果画面表示
5. 再プレイボタン有効化

### 3.7 クライアントサイドイベント設計

#### DOMイベント
- **click**: クリックボタン、再プレイボタン
- **load**: 画像読み込み完了
- **resize**: ウィンドウサイズ変更（レスポンシブ対応）
- **beforeunload**: ページ離脱前の処理

#### カスタムイベント
- **gameStart**: ゲーム開始時
- **gameEnd**: ゲーム終了時
- **recordUpdate**: 記録更新時
- **characterChange**: キャラクター変更時

## 4. バックエンド処理設計

本システムはクライアントサイドのみで動作するため、バックエンド処理は存在しない。
すべての処理をJavaScriptで実装する。

### 4.1 クライアントサイド業務フロー

#### 数字特別判定ロジック
- **3の倍数判定**: `count % 3 === 0 && count > 0`
- **3を含む数字判定**: `count.toString().includes('3')`
- **論理結合**: OR条件で両方を判定

#### タイマー処理ロジック
- **開始**: `performance.now()`で高精度時間取得
- **終了**: 開始時間との差分計算
- **表示**: 小数点以下2桁での四捨五入

#### 記録管理ロジック
- **初回判定**: localStorage値の存在確認
- **比較処理**: 現在時間と保存記録の数値比較
- **更新処理**: より速い記録での上書き

### 4.2 データ処理ロジック

#### 画像管理処理
- **プリロード**: ゲーム開始前に全画像を事前読み込み
- **ランダム選択**: Math.random()による配列要素選択
- **エラーハンドリング**: 画像読み込み失敗時の代替処理

#### 状態管理処理
- **状態変更**: 必ず専用関数経由での更新
- **整合性保証**: 無効な状態遷移の防止
- **永続化**: 必要なデータのみの選択的保存

## 5. 外部連携・リソース設計

### 5.1 外部API連携

本システムでは外部APIとの連携は行わない。

### 5.2 静的リソース管理

#### キャラクター画像仕様
- **形式**: PNG, JPG, SVG対応
- **サイズ**: 推奨500×500px、最大1MB
- **命名規則**: 
  - 通常表情: `normal_01.png` ～ `normal_05.png`
  - アホ顔: `silly_01.png`, `silly_02.png`
- **配置場所**: `images/characters/` ディレクトリ

#### UI素材
- **アイコン**: 必要に応じてCDN経由のアイコンフォント使用
- **フォント**: Google Fonts CDN経由で読み込み
- **効果音**: 実装予定なし（将来拡張可能な設計）

### 5.3 セキュリティ設計

#### データ保護
- **個人情報**: 収集・保存しない
- **記録データ**: ローカル保存のみ、外部送信なし
- **入力検証**: 不正な値での記録保存防止

#### セキュリティ対策
- **XSS対策**: innerHTML使用時のサニタイゼーション
- **CSRF対策**: 外部API不使用のため不要
- **プライバシー**: Cookieや個人識別情報不使用

### 5.4 非機能要件への対応

#### 性能最適化
- **画像最適化**: 適切なファイルサイズでの提供依頼
- **JavaScript最適化**: 不要なDOM操作の削減
- **CSS最適化**: 効率的なセレクタ使用
- **リソース圧縮**: 本番環境での圧縮実施

#### 互換性保証
- **ブラウザ対応**: ES6機能の適切な使用
- **フォールバック**: localStorage無効時の代替動作
- **レスポンシブ**: 全デバイスでの適切な表示

#### アクセシビリティ
- **キーボード操作**: Space/Enterキーでのボタン操作対応
- **ARIA属性**: スクリーンリーダー対応
- **色彩対応**: カラーコントラスト比の適切な設定
- **フォーカス管理**: 適切なタブオーダーの実装

---

**作成日**: 2025年8月1日  
**版数**: 1.0  
**作成者**: Web開発ディレクター  
**承認**: 要承認

## 次のステップ

本基本設計書の承認後、以下の作業に進む：

1. **詳細設計**: 各モジュールの詳細仕様策定
2. **画面モックアップ**: 実際の見た目の確認
3. **開発環境構築**: 開発ツールのセットアップ
4. **実装**: 設計書に基づくコーディング作業
5. **テスト**: 機能・互換性・性能テストの実施