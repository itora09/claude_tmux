# 結果表示領域 - 画面仕様書

## 1. 画面概要
- **目的**: ゲーム終了時の結果表示と記録判定の提供による達成感創出と再プレイ促進
- **主要機能**: 
  - ゲーム完了時間の表示（小数点以下2桁形式）
  - 記録判定結果の表示（新記録/既存記録）
  - 再プレイボタンによるゲーム再開機能
  - 記録の永続化（localStorage）
  - 達成感を高める視覚的フィードバック
- **対象ユーザー**: クリックゲームをプレイした全ユーザー（全年齢対象）
- **画面の位置づけ**: ゲーム終了時にメイン画面に重畳表示される結果モーダル

## 2. 画面レイアウト

### レイアウト図
```
┌──────────────────────────────────────┐
│              モーダル背景              │
│  ┌────────────────────────────────┐  │
│  │         結果表示モーダル         │  │
│  │  ┌────────────────────────┐  │  │
│  │  │       🎉 ゲーム完了！      │  │  │
│  │  └────────────────────────┘  │  │
│  │                              │  │
│  │     今回のタイム: XX.XX秒     │  │
│  │                              │  │
│  │  ┌────────────────────────┐  │  │
│  │  │     記録判定メッセージ     │  │  │
│  │  │  （新記録！ or 最速記録）  │  │  │
│  │  └────────────────────────┘  │  │
│  │                              │  │
│  │  ┌────────────────────────┐  │  │
│  │  │     もう一度プレイ        │  │  │
│  │  │       ボタン             │  │  │
│  │  └────────────────────────┘  │  │
│  └────────────────────────────────┘  │
└──────────────────────────────────────┘
```

### 画面サイズ対応
- **デスクトップ（1024px以上）**: モーダル幅500px × 高さ400px、中央配置
- **タブレット（768px-1023px）**: モーダル幅400px × 高さ350px、中央配置  
- **モバイル（320px-767px）**: 画面幅の90% × 高さ自動、中央配置

### 主要エリア
- **モーダル背景**: 半透明オーバーレイ（メイン画面を暗くする）
- **結果表示コンテナ**: 中央配置の白背景モーダル
- **ヘッダーエリア**: ゲーム完了タイトルとアイコン表示
- **タイム表示エリア**: 今回の結果時間を大きく表示
- **記録判定エリア**: 新記録判定結果の表示
- **アクションエリア**: 再プレイボタンの配置

## 3. 一覧表示
- **表示対象**: 単一ゲーム結果（一覧表示機能は提供しない）
- **表示件数**: N/A
- **ソート機能**: N/A
- **フィルタ機能**: N/A

## 4. 画面項目定義

| 項目名 | 種別 | 必須 | 最大長 | 形式 | 初期値 | 備考 |
|--------|------|------|--------|------|--------|------|
| ゲーム完了タイトル | 表示 | ○ | - | 文字列 | "ゲーム完了！" | 固定メッセージ |
| 結果アイコン | 表示 | ○ | - | 絵文字/画像 | 🎉 | 新記録時は🏆に変更 |
| 今回タイム | 表示 | ○ | 7文字 | XX.XX秒 | - | 小数点以下2桁表示 |
| 記録判定メッセージ | 表示 | ○ | 30文字 | テキスト | - | 条件によって変動 |
| 最速記録 | 表示 | - | 7文字 | XX.XX秒 | - | 記録更新できない場合のみ |
| 再プレイボタン | 入力 | ○ | 12文字 | ボタン | "もう一度プレイ" | クリック可能 |
| モーダル背景 | 表示 | ○ | - | 背景 | 半透明黒 | オーバーレイ |

## 5. 入出力一覧

| 処理 | 対象 | テーブル/ファイル名 | 操作種別 | 備考 |
|------|------|-------------------|----------|------|
| 最速記録読み込み | 入力 | localStorage["clickGameBestTime"] | 参照 | 記録比較用 |
| 最速記録更新 | 出力 | localStorage["clickGameBestTime"] | 更新 | 新記録時のみ |
| ゲーム時間表示 | 出力 | 画面表示 | 表示 | 小数点以下2桁形式 |
| 記録判定表示 | 出力 | 画面表示 | 表示 | 条件分岐による |
| ゲーム状態初期化 | 出力 | メモリ（GameState） | 更新 | 再プレイ時の状態リセット |

## 6. 画面イベント一覧

| イベント名 | 発生タイミング | 処理内容 | 画面遷移 | サーバ通信 |
|------------|----------------|----------|----------|------------|
| 結果表示開始 | ゲーム終了時（40回到達時） | 結果計算・記録判定・画面表示 | 無 | 無 |
| 記録判定処理 | 結果画面表示時 | 最速記録との比較・判定メッセージ生成 | 無 | 無 |
| 再プレイボタンクリック | ボタンクリック時 | ゲーム状態初期化・画面クローズ | 有（メイン画面） | 無 |
| モーダル背景クリック | 背景クリック時 | 画面クローズ | 有（メイン画面） | 無 |
| キーボード操作 | Enter/Escキー押下時 | 再プレイ実行またはモーダルクローズ | 有（メイン画面） | 無 |
| 記録更新 | 新記録達成時 | localStorage保存 | 無 | 無 |

## 7. 画面イベント詳細

### 7.1 結果表示開始イベント

#### 発生条件
- ゲームカウンターが40に到達した時
- タイマー停止処理完了後

#### 入力チェック（バリデーション）
- タイムデータの正常性確認（0秒以下、異常値の検出）
- 最速記録の数値妥当性確認
- 表示用データの形式確認

#### 画面表示制御
- **モーダル表示**: フェードイン効果付きで表示（0.3秒のease-out）
- **背景オーバーレイ**: 70%透明度の黒背景を適用
- **フォーカス管理**: 再プレイボタンに自動フォーカス設定
- **スクロール無効化**: モーダル表示中は背景スクロールを禁止
- **要素の順次表示**: タイトル → 時間 → 記録判定 → ボタンの順で0.1秒間隔

#### テーブル操作
- localStorage から最速記録を読み取り（localStorage.getItem('clickGameBestTime')）
- 新記録時の記録更新（localStorage.setItem）

#### 記録判定ロジック
```javascript
if (localStorage["clickGameBestTime"] === undefined) {
    // 初回プレイの場合
    displayMessage = currentTime + "秒でした！";
    saveBestTime(currentTime);
} else {
    let bestTime = parseFloat(localStorage["clickGameBestTime"]);
    if (currentTime < bestTime) {
        // 新記録の場合
        displayMessage = "新記録！" + currentTime + "秒でした！";
        saveBestTime(currentTime);
    } else {
        // 記録更新できない場合
        displayMessage = currentTime + "秒でした！最速記録: " + bestTime + "秒";
    }
}
```

#### 画面遷移
- 遷移先：メイン画面（ゲーム初期状態）
- 遷移条件：再プレイボタンクリック、背景クリック、ESCキー

#### エラーハンドリング
- localStorage無効時：記録機能を無効化、他機能は正常動作
- 表示データ異常時：デフォルト値での表示継続
- 時間計算エラー：デフォルト値（"--秒"）を表示

### 7.2 記録判定処理

#### 判定ロジック
- 初回プレイ時：今回のタイムをlocalStorageに保存
- 新記録時：特別なアイコン（🏆）、祝福色のテキスト（金色）で表示
- 記録更新なし時：通常アイコン（🎉）、標準色のテキストで表示

#### 画面表示制御
- **新記録時**: 特別なアニメーション・エフェクト（1秒間の軽微な光る効果）
- **アニメーション**: 新記録時は軽微な点滅効果

### 7.3 再プレイボタンクリックイベント

#### 発生条件
- ユーザーが「もう一度プレイ」ボタンをクリック
- ボタンが活性状態である

#### 入力チェック（バリデーション）
- 特になし（ボタンクリックのみ）

#### 画面表示制御
- モーダルのフェードアウト効果（0.2秒）
- 背景オーバーレイの削除
- スクロール制御の解除
- メイン画面の操作可能状態復帰

#### テーブル操作
- ゲーム状態の完全初期化
  - clickCount: 0
  - gameStatus: 'waiting'
  - startTime: null
  - endTime: null
  - currentCharacter: 初期画像

#### 画面遷移
- メイン画面への復帰
- キャラクター表情の初期化
- カウンター表示のリセット
- クリックボタンの有効化

#### エラーハンドリング
- DOM操作エラー: エラーログ出力、手動リロードを促すメッセージ表示
- 状態リセットエラー: 部分的リセット実行、継続可能な機能のみ提供
- 初期化処理失敗時：ページリロードによる強制初期化

### 7.4 キーボード・アクセシビリティ対応

#### キーボード操作対応
- **Tab**: 再プレイボタンへのフォーカス移動
- **Enter/Space**: 再プレイボタンの実行
- **Escape**: モーダルクローズ

#### アクセシビリティ対応
- **ARIA属性**: 
  - role="dialog"（モーダルダイアログ）
  - aria-labelledby（タイトル要素の関連付け）
  - aria-describedby（説明文の関連付け）
- **フォーカストラップ**: モーダル内でのフォーカス循環
- **スクリーンリーダー対応**: 結果の読み上げ対応

## 8. UI/UXデザイン仕様

### 8.1 デザインテーマ
- **基調**: ポップで可愛い、ふわふわした優しい印象
- **色彩**: 明るいパステルカラー（ピンク、水色、クリーム色）
- **フォント**: 丸みのある読みやすいフォント（Comic Sans MS）

### 8.2 カラーパレット
- **背景オーバーレイ**: rgba(0, 0, 0, 0.7)
- **モーダル背景**: #FFFFFF
- **境界線**: 2px solid #FFB6C1 (ライトピンク)
- **テキスト色（通常）**: #333333
- **テキスト色（新記録）**: #FFD700（金色）
- **ボタン背景**: #87CEEB（スカイブルー）
- **ボタンホバー**: #4169E1（ロイヤルブルー）

### 8.3 タイポグラフィ
- **タイトル**: 24px（デスクトップ）、20px（モバイル）、bold、#FF69B4
- **タイム表示**: 32px（デスクトップ）、26px（モバイル）、monospace、#4169E1
- **メッセージ**: 18px（デスクトップ）、16px（モバイル）、normal
- **ボタンテキスト**: 16px、bold、#FFFFFF

### 8.4 コンポーネント仕様

#### 結果モーダル
- **背景色**: rgba(255, 255, 255, 0.95)
- **角丸**: border-radius: 20px
- **影**: box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2)

#### 再プレイボタン
- **パディング**: 12px 24px
- **角丸**: border-radius: 25px
- **最小サイズ**: 44px × 44px（タッチ対応）

### 8.5 アニメーション・エフェクト
- **モーダル表示**: 0.3秒のフェードイン（ease-out）
- **モーダル非表示**: 0.2秒のフェードアウト
- **新記録時**: 1秒間の軽微な光る効果
- **ボタンホバー**: 0.2秒のスムーズな色変化

#### CSS アニメーション
```css
.result-modal {
    opacity: 0;
    transform: scale(0.8);
    transition: all 0.3s ease-out;
}

.result-modal.show {
    opacity: 1;
    transform: scale(1.0);
}

.result-item {
    opacity: 0;
    animation: fadeInUp 0.3s ease-out forwards;
}

.result-item:nth-child(1) { animation-delay: 0.1s; }
.result-item:nth-child(2) { animation-delay: 0.2s; }
.result-item:nth-child(3) { animation-delay: 0.3s; }
.result-item:nth-child(4) { animation-delay: 0.4s; }
```

### 8.6 レスポンシブデザイン詳細

#### ブレークポイント
- **Large（1024px以上）**: デスクトップ最適化
- **Medium（768px-1023px）**: タブレット最適化
- **Small（320px-767px）**: モバイル最適化

#### デバイス別調整
- **モバイル**: タッチ操作を考慮したボタンサイズ（最小44px×44px）
- **タブレット**: 中間サイズでの適切な要素配置
- **デスクトップ**: マウス操作に最適化されたホバー効果

### 8.7 ユーザビリティ向上施策

#### 視認性向上
- **高コントラスト**: WCAG 2.1 AA基準準拠
- **大きなフォント**: 小さな画面でも読みやすいサイズ
- **明確な階層**: 情報の重要度に応じたサイズ・色の使い分け

#### 操作性向上
- **大きなボタン**: タッチデバイスでの操作性確保
- **明確なフィードバック**: ボタン押下時の視覚的反応
- **直感的な配置**: ユーザーの期待に沿った要素配置

#### エンゲージメント向上
- **達成感の演出**: 新記録時の特別な表現
- **継続性の促進**: 再プレイへの自然な誘導
- **感情的フィードバック**: 可愛らしい絵文字・アイコンの活用

## 9. データフロー設計

### 9.1 入力データフロー
```
ゲーム終了時刻
    ↓
タイム計算処理
    ↓
localStorage記録読み取り
    ↓
記録比較判定
    ↓
表示データ生成
    ↓
結果画面表示
```

### 9.2 出力データフロー
```
ユーザー操作
    ↓
操作種別判定
    ↓
記録保存処理（新記録時）
    ↓
画面状態更新
    ↓
遷移先画面表示
```

## 10. エラーハンドリング仕様

### 10.1 表示エラー対応
- **症状**: モーダル表示失敗
- **対応**: デフォルトアラートでの結果表示
- **ユーザー向け案内**: "結果画面の表示に失敗しました。XX.XX秒でした。"

### 10.2 記録保存エラー対応
- **症状**: localStorage書き込み失敗
- **対応**: セッション中のみ記録保持
- **ユーザー向け案内**: "記録の保存に失敗しましたが、プレイは継続できます。"

### 10.3 データ読み込みエラー対応
- **症状**: localStorage読み取り失敗
- **対応**: 初回プレイとして扱い継続
- **ユーザー向け案内**: "記録データの読み込みに失敗しました。初回プレイとして処理します。"

## 11. 性能・セキュリティ要件

### 11.1 性能要件
- **表示応答時間**: 200ms以内
- **アニメーション**: 60fps維持
- **メモリ使用量**: 結果表示時の追加メモリ使用量を50MB以下に制限

### 11.2 セキュリティ要件
- **データ検証**: 入力値のサニタイゼーション実施
- **XSS対策**: innerHTML使用時の適切なエスケープ処理
- **データ改ざん防止**: localStorage値の妥当性チェック実施

---

**作成日**: 2025年8月2日  
**版数**: 1.0  
**作成者**: boss1（worker1, worker2, worker3の成果物統合）  
**対象システム**: クリックゲームWebアプリケーション