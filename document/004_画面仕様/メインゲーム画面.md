# メインゲーム画面仕様書

## 1. 画面概要

### 目的
クリックゲームのメイン操作を行う画面。40回クリック達成までの時間を競うゲームプレイ機能を提供。

### 主要機能
- クリックボタンによるカウント機能（0〜40回）
- クリック数に応じたキャラクター表情変化機能（3の倍数・3を含む数字で特別表情）
- タイム測定機能（1回目〜40回目クリックまでの時間）
- 最速記録保存・表示機能（localStorage使用）
- ゲーム状態管理機能（待機→プレイ中→結果表示）

### 対象ユーザー
年齢問わず誰でも利用可能。スマートフォン、タブレット、デスクトップPCでの操作を想定。

### 画面の位置づけ
本システムの中核画面。ゲームプレイ全体を統括し、すべての機能がこの画面上で完結する単一画面アプリケーション。

## 2. 画面レイアウト

### レイアウト図
```
┌─────────────────────────────────────┐
│            【最速記録表示】           │
│         "最速記録: XX.XX秒"          │
├─────────────────────────────────────┤
│                                     │
│         【キャラクター表示】          │
│            400×400px               │
│          (ポップで可愛い)            │
│                                     │
├─────────────────────────────────────┤
│           【カウンター表示】          │
│              "XX / 40"             │
│             (大きな文字)             │
├─────────────────────────────────────┤
│           【クリックボタン】          │
│          "クリック！" or "スタート"    │
│            200×80px               │
├─────────────────────────────────────┤
│          【ゲーム状態表示】           │
│        (タイム表示 or 結果表示)       │
└─────────────────────────────────────┘
```

### 画面サイズ対応
- **デスクトップ（1024px以上）**: 最大幅800px、中央配置
- **タブレット（768px-1023px）**: 最大幅600px
- **モバイル（320px-767px）**: 最大幅90%、縦スクロール対応

### 主要エリア配置
1. **ヘッダーエリア**: 最速記録表示（固定表示）
2. **メインコンテンツエリア**: キャラクター表示（中央・大きく）
3. **操作エリア**: カウンター + クリックボタン（目立つ配置）
4. **フッターエリア**: ゲーム状態・結果表示（動的変更）

## 3. 一覧表示

### 表示対象
該当なし（単一画面でのゲームプレイのため）

### 表示件数
該当なし

### ソート機能
該当なし

### フィルタ機能
該当なし

## 4. 画面項目定義

| 項目名 | 種別 | 必須 | 最大長 | 形式 | 初期値 | 備考 |
|--------|------|------|--------|------|--------|------|
| 最速記録表示 | 表示 | - | - | "最速記録: XX.XX秒" | "まだ記録がありません" | localStorage値に依存 |
| キャラクター画像 | 表示 | ○ | - | 画像ファイル | normal_01.png | 5種類通常+2種類アホ顔 |
| カウンター表示 | 表示 | ○ | - | "XX / 40" | "0 / 40" | 0〜40の整数 |
| クリックボタン | 入力 | ○ | - | ボタン要素 | "スタート" | クリック時→"クリック！" |
| 現在タイム表示 | 表示 | - | - | "XX.XX秒" | 非表示 | ゲーム中のみ表示 |
| 結果表示 | 表示 | - | - | 文字列 | 非表示 | ゲーム終了時のみ |
| 再プレイボタン | 入力 | - | - | ボタン要素 | 非表示 | 結果表示時のみ |

## 5. 入出力一覧

| 処理 | 対象 | テーブル/ファイル名 | 操作種別 | 備考 |
|------|------|-------------------|----------|------|
| 最速記録読み込み | 入力 | localStorage | 参照 | キー: "clickGameBestTime" |
| 最速記録保存 | 出力 | localStorage | 更新 | 新記録達成時のみ |
| キャラクター画像読み込み | 入力 | images/characters/ | 参照 | normal/*.png, silly/*.png |
| ゲーム状態管理 | 入出力 | ブラウザメモリ | 更新 | GameStateオブジェクト |

## 6. 画面イベント一覧

| イベント名 | 発生タイミング | 処理内容 | 画面遷移 | サーバ通信 |
|------------|----------------|----------|----------|------------|
| 画面初期化 | ページ読み込み時 | 初期状態設定、記録読み込み | 無 | 無 |
| クリックボタン押下 | ボタンクリック時 | カウント増加、キャラ変更 | 無 | 無 |
| ゲーム開始 | 初回クリック時 | タイマー開始、状態変更 | 無 | 無 |
| ゲーム終了 | 40回到達時 | タイマー停止、結果判定 | 無 | 無 |
| 再プレイ | 再プレイボタン押下 | 状態リセット、再初期化 | 無 | 無 |
| ウィンドウリサイズ | 画面サイズ変更時 | レスポンシブ調整 | 無 | 無 |

## 7. 画面イベント詳細

### 7.1 画面初期化イベント
- **入力チェック（バリデーション）**: localStorage有効性確認、画像ファイル存在確認、必要なDOM要素の存在確認
- **画面表示制御**: 
  - カウンター: "0 / 40"表示
  - ボタン: "スタート"テキスト、有効状態
  - 結果表示エリア: 非表示
  - キャラクター: 通常表情をランダム選択
- **テーブル操作**: localStorageから最速記録読み込み
- **画面遷移**: なし
- **エラーハンドリング**: 
  - localStorage無効時: 記録機能無効化、他機能継続
  - 画像読み込み失敗時: プレースホルダー画像表示
  - DOM要素不足時: エラーメッセージ表示

### 7.2 クリックボタン押下イベント
- **入力チェック（バリデーション）**: 
  - ゲーム状態確認（40回未達成）
  - 連続クリック制御（100ms以内の重複クリック防止）
- **画面表示制御**:
  - カウンター: インクリメント表示
  - ボタンテキスト: "スタート"→"クリック！"
  - キャラクター: 条件に応じた表情変更
  - 初回クリック時にタイマー開始表示
- **テーブル操作**: GameState更新（clickCount増加、初回時のstartTime設定）
- **画面遷移**: カウント40到達時は結果表示状態に移行
- **エラーハンドリング**: 
  - 無効クリック時は処理スキップ
  - 不正なカウント値: カウンターリセット
  - タイマー異常: 現在時刻で強制設定

### 7.3 ゲーム開始イベント（初回クリック）
- **入力チェック（バリデーション）**: 初回クリック判定（カウンターが0であることを確認）
- **画面表示制御**:
  - タイマー表示: 開始
  - ボタン状態: "クリック！"表示継続
  - ゲーム状態を"プレイ中"に変更
- **テーブル操作**: GameState更新（gameStatus: playing, startTime設定）
- **画面遷移**: なし
- **エラーハンドリング**: タイマー初期化失敗時はエラー表示

### 7.4 ゲーム終了イベント（40回到達）
- **入力チェック（バリデーション）**: 
  - 40回到達確認
  - startTimeとendTimeの整合性確認
  - 計算結果の妥当性確認（0秒以下でないこと）
- **画面表示制御**:
  - クリックボタン: 無効化
  - 結果表示エリア: 表示
  - 再プレイボタン: 表示・有効化
  - 今回のタイムを表示
  - 記録判定結果を表示
- **テーブル操作**: 
  - GameState更新（gameStatus: finished, endTime設定）
  - 記録判定・localStorage更新（新記録時）
- **画面遷移**: なし
- **エラーハンドリング**: 
  - 記録保存失敗時は警告表示、ゲーム継続
  - 時間計算エラー: 「計測エラー」と表示
  - localStorage保存エラー: 「記録保存に失敗しました」と表示

### 7.5 再プレイイベント
- **入力チェック（バリデーション）**: 
  - ボタン有効状態確認
  - ゲーム状態がfinishedであることを確認
- **画面表示制御**:
  - 全要素を初期状態にリセット
  - カウンター: "0 / 40"
  - ボタン: "スタート"、有効化
  - 結果表示: 非表示
  - キャラクター画像を通常表情のランダム1枚に設定
- **テーブル操作**: GameState初期化（最速記録は保持）
- **画面遷移**: なし
- **エラーハンドリング**: 初期化失敗時はページリロード推奨表示

### 7.6 ウィンドウリサイズイベント
- **入力チェック（バリデーション）**: 
  - 新しい画面サイズの妥当性確認
  - 最小幅（320px）以上であることを確認
- **画面表示制御**: 
  - レスポンシブレイアウトの適用
  - キャラクター画像サイズの調整
  - ボタンサイズの調整
  - フォントサイズの調整
- **テーブル操作**: なし（表示調整のみ）
- **画面遷移**: なし
- **エラーハンドリング**: 
  - CSS適用エラー: デフォルトスタイルで継続
  - 画像サイズ調整エラー: 元のサイズを維持

## 8. 特別ロジック仕様

### 8.1 キャラクター表情変更ロジック
- **条件判定**:
  - 3の倍数判定: `clickCount % 3 === 0 && clickCount > 0`
  - 3を含む数字判定: `clickCount.toString().includes('3')`
  - 特別条件: 上記いずれかが真の場合
- **画像選択**:
  - 特別条件時: silly_01.png または silly_02.png をランダム選択
  - 通常時: normal_01.png ～ normal_05.png をランダム選択
- **表示更新**: 画像src属性の即座更新

### 8.2 タイム測定・記録管理
- **測定精度**: performance.now()使用、ミリ秒精度
- **表示形式**: 小数点以下2桁（例: "12.34秒"）
- **記録判定**: 
  - 初回プレイ: 無条件で記録登録
  - 2回目以降: 現在タイム < 保存記録 の場合に更新
- **結果表示**:
  - 新記録: "新記録！XX.XX秒でした！"
  - 非更新: "XX.XX秒でした！最速記録: YY.YY秒"
  - 初回: "XX.XX秒でした！"

### 8.3 レスポンシブデザイン仕様
- **ブレークポイント**:
  - モバイル: 320px - 767px
  - タブレット: 768px - 1023px  
  - デスクトップ: 1024px以上
- **要素サイズ調整**:

| 要素 | モバイル | タブレット | デスクトップ |
|------|----------|------------|--------------|
| キャラクター | 250×250px | 300×300px | 400×400px |
| クリックボタン | 150×60px | 180×70px | 200×80px |
| カウンターフォント | 36px | 48px | 64px |
| 最大幅 | 90% | 600px | 800px |

- **タッチ操作対応**:
  - ボタン最小サイズ: 44×44px（アクセシビリティ基準）
  - タップ範囲拡張: padding で実際より大きな操作領域確保
  - ホバー効果: タッチデバイスでは無効化

### 8.4 技術仕様
- **フロントエンド技術**: HTML5、CSS3、バニラJavaScript（ES6+）
- **レスポンシブデザイン**: Flexbox/Grid使用
- **データ保存**: localStorage による記録保存
- **画像仕様**: PNG/JPG/SVG対応、推奨500×500px、最大1MB
- **ブラウザ対応**: 
  - デスクトップ: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
  - モバイル: iOS Safari 14+, Android Chrome 90+
- **性能要件**:
  - クリック時の反応時間: 100ms以内
  - 画像切り替え時間: 200ms以内
  - タイマー精度: ±10ms以内

---

**作成日**: 2025年8月2日  
**版数**: 1.0  
**作成者**: boss1（worker1,2,3統合版）  
**参照資料**: 要求定義書、要件定義書、基本設計書